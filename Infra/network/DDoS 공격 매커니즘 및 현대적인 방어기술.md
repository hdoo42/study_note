---
id: DDoS 공격 매커니즘 및 현대적인 방어기술
aliases: []
tags:
  - DDoS
  - XDP
  - eBPF
  - Smurf
---
## 1. 개념의 정립: 좀비 PC vs 반사 공격

사용자의 초기 오개념(좀비 PC가 핑을 튕겨내는 벽 역할을 한다)을 교정하고, 두 공격 유형의 정확한 데이터 흐름을 정의함.

| **구분**     | **좀비 PC (Botnet/DDoS)**                            | **반사 공격 (Reflective DDoS)**                           |
| ---------- | -------------------------------------------------- | ----------------------------------------------------- |
| **공격 주체**  | 해커의 명령(C&C)을 받은 감염된 PC                             | 해커에게 속은 **정상적인 서버** (DNS, NTP 등)                      |
| **핵심 기법**  | **능동적 실행:** "공격해" 명령 수행                            | **IP 변조(Spoofing):** 피해자가 요청한 척 위장                    |
| **데이터 흐름** | Attacker $\rightarrow$ Zombie $\rightarrow$ Victim | Attacker $\rightarrow$ Reflector $\rightarrow$ Victim |
| **로그 분석**  | 좀비 PC들의 실제 IP가 남음                                  | **반사체(DNS 서버 등)의 IP만 남음** (추적 난해)                     |

## 2. 반사 공격(Reflection & Amplification)의 작동 원리

반사 공격이 치명적인 이유는 '방향 전환'뿐만 아니라 **'크기 증폭'**에 있다.

- **방향 전환 (IP Spoofing):**
    
    - 공격자는 패킷의 `Source IP`를 **피해자 IP**로 변조하여 제3의 서버(반사체)에 전송.
        
    - 반사체는 응답을 `Source IP`(피해자)에게 발송.
        
- **크기 증폭 (Amplification):**
    
    - 비대칭 프로토콜(UDP 기반 DNS, NTP)의 특성 악용.
        
    - **1**의 요청(Query, 60 bytes)을 보내면 **50~100**의 응답(Response, 3000 bytes)이 피해자에게 쏟아짐.
        
    - **결과:** 공격자는 적은 대역폭으로 기업급 서버를 마비시킬 수 있음 (DRDoS).
        

## 3. 방어 메커니즘: 이상과 현실

공격의 핵심인 '거짓말(Spoofing)'을 어디서 차단하느냐에 따른 계층별 방어 전략.

- **L1. 근본적 해결 (ISP 레벨 - Ingress Filtering):**
    
    - ISP 라우터가 "네가 할당받은 IP와 패킷의 보낸 주소가 일치하는가?"를 검사.
        
    - 불일치 시 **입구 컷(Drop)**. (전 세계적 도입 미비로 완벽한 방어 불가)
        
- **L2. 현실적 방어 (Scrubbing Center - Cloudflare 등):**
    
    - 거대한 대역폭(Anycast)으로 트래픽을 분산 흡수(Tanking).
        
    - 정상 트래픽과 공격 트래픽을 분류하여 **정화(Scrubbing)** 후 원본 서버로 전달.
        

## 4. 심화 기술: 초고속 패킷 처리 (High-Performance Packet Dropping)

초당 수백만 개의 패킷(Mpps)을 **지연 없이($\mu s$ 단위)** 처리하기 위한 기술적 구현.

### A. 검사 속도의 혁신: 블룸 필터 (Bloom Filter)

- **문제:** 들어오는 응답 패킷마다 DB를 뒤져 "요청한 적 있는지" 확인하면 너무 느림($O(N)$).
    
- **해결:** 확률적 자료구조인 블룸 필터 사용.
    
- **원리:** 해시 함수를 통해 비트 배열에 마킹. 수학적 연산 한 번으로 **"요청한 적 없음(100% 확실)"**을 즉시 판별.
    

### B. 폐기 위치의 혁신: XDP & eBPF

- **문제:** 패킷을 OS 커널(메모리 할당, [[sk_buff|sk_buff]]가 큼.
    
- **해결:** **XDP (eXpress Data Path)** 기술 적용.
    
- **원리:** 네트워크 카드(NIC) **드라이버 단계**에서 패킷을 검사하고 폐기.
    
- **효과:** 운영체제가 패킷의 존재를 알기도 전에 삭제되므로 **CPU/메모리 부하가 거의 없음.**
    

---

### 최종 요약 (The Key Takeaway)

> **"DDoS 반사 공격은 공격자가 '보낸 사람(Source)'을 속여 '제3자(Reflector)'의 힘을 빌려 '증폭(Amplification)'된 타격을 입히는 기술이며, 이를 막기 위해서는 커널 메모리에 진입하기 전(XDP) 아주 찰나의 순간($\mu s$)에 수학적 확률(Bloom Filter)로 거짓말을 걸러내야 한다."**
