---
id: Idempotency
aliases: []
tags: []
---

**멱등성(Idempotency)** 이란, **"어떤 작업을 한 번 실행하든, 여러 번 반복해서 실행하든 결과가 항상 동일하게 유지되는 성질"** 을 말합니다.

IT 인프라 자동화(Ansible, Terraform 등)에서 가장 중요하게 여기는 개념 중 하나입니다.

이해하기 쉽게 실생활 예시와 코딩 예시로 비교해 드릴게요.

-----

### 1. 실생활 예시: 엘리베이터 버튼

  * **멱등성이 있는 경우:** 엘리베이터 버튼을 이미 눌렀는데, 조바심에 10번을 더 연타했습니다. 하지만 엘리베이터는 **단 한 대만** 옵니다. (결과가 변하지 않음 → **멱등성 O**)
  * **멱등성이 없는 경우:** 온라인 쇼핑몰에서 '결제하기' 버튼을 실수로 10번 눌렀는데, **돈이 10번 빠져나갔습니다.** (누르는 횟수만큼 결과가 변함 → **멱등성 X**)

-----

### 2. Ansible(개발)에서의 차이점

방금 질문하신 **"디렉토리 생성"**을 예로 들어보겠습니다.

#### A. 멱등성이 없는 방식 (Shell 명령어)

```bash
mkdir /goinfre/data
```

  * **첫 번째 실행:** 폴더가 생성됨 (성공).
  * **두 번째 실행:** "이미 존재하는 폴더입니다"라며 **에러 발생 (실패).**
  * **문제점:** 스크립트를 여러 번 돌릴 수가 없어, 매번 상태를 확인하는 코드를 추가해야 합니다.

#### B. 멱등성이 있는 방식 (Ansible 모듈)

```yaml
- name: 디렉토리 생성
  ansible.builtin.file:
    path: /goinfre/data
    state: directory
```

  * **첫 번째 실행:** 폴더가 없으면 생성함. (**Changed: True**)
  * **두 번째 실행:** "이미 있네?" 하고 아무것도 안 함. (**Changed: False**, **에러 없음**)
  * **장점:** 100번을 실행해도 항상 "폴더가 존재하는 상태"를 안전하게 보장합니다.

-----

### 3. 아까 코드에서 멱등성이 왜 중요할까요?

제가 **방법 1 (Ansible Native 모듈)**을 권장해 드린 이유가 바로 이 **멱등성** 때문입니다.

  * **방법 1 (`find` + `file` 모듈):**

      * 삭제할 파일이 없으면 Ansible이 "아무것도 안 함(Green, OK)"으로 표시합니다.
      * 삭제할 파일이 있을 때만 "변경됨(Yellow, Changed)"으로 표시합니다.
      * **결과:** 로그만 봐도 "아, 이번엔 지운 파일이 없구나" 혹은 "이번엔 청소가 됐구나"를 명확히 알 수 있습니다.

  * **방법 2 (`shell` 명령어):**

      * 삭제할 파일이 있든 없든 `find` 명령어를 무조건 실행합니다.
      * 별도 설정을 안 하면, 파일이 없어도 무조건 "변경됨(Changed)"이라고 거짓 보고를 할 수 있습니다.

**요약하자면:**
멱등성을 지키면 **"여러 번 돌려도 시스템이 망가지지 않고, 불필요한 작업은 건너뛴다"**는 안심을 할 수 있습니다.

이 개념을 이해하면 Ansible을 훨씬 더 고급스럽게 사용하실 수 있습니다. 혹시 `find` 모듈 외에 다른 부분도 멱등성 있게 바꾸고 싶은 부분이 있으신가요?
