Q: inclusive and exclusive cache에 대해? AMD와 intel이 여전히 서로 다른 방식을 사용해?

`Inclusive (포괄적) 캐시`와 `Exclusive (배타적) 캐시`는 CPU의 L1, L2 같은 하위 레벨 캐시에 있는 데이터가 L3와 같은 최상위 레벨 캐시(LLC, Last Level Cache)에 어떻게 저장되는지를 규정하는 정책입니다.

결론부터 말씀드리면, **과거에는 Intel과 AMD가 각각 포괄적, 배타적 방식으로 명확히 달랐지만, 현재는 두 회사 모두 '비포괄적(Non-Inclusive)'이라는 절충안으로 사실상 수렴했습니다.**

---

## Inclusive (포괄적) vs. Exclusive (배타적)

이해를 돕기 위해 코어에 가까운 L1/L2 캐시와 모든 코어가 공유하는 L3 캐시(LLC)를 기준으로 설명합니다.

### 1. 포괄적 (Inclusive) 캐시

- **정의:** L3 캐시가 하위 레벨(L1, L2) 캐시의 **모든 데이터 복사본을 반드시 포함**하는 방식입니다. (L3⊇L2⊇L1)
    
- **장점:**
    
    - **간단한 캐시 일관성(Coherency) 관리:** 다른 코어가 특정 데이터를 가지고 있는지 확인하려면 L3 캐시만 검색(snoop)하면 됩니다. L3에 없으면 다른 코어의 L1/L2에도 없습니다.
        
- **단점:**
    
    - **공간 낭비:** L2 캐시에 있는 데이터가 L3 캐시에도 중복으로 저장됩니다. 만약 L2 캐시의 총합이 L3 용량의 상당 부분을 차지하면 실제 L3에서 활용할 수 있는 순수 공간이 줄어듭니다.
        

### 2. 배타적 (Exclusive) 캐시

- **정의:** L3 캐시는 하위 레벨(L1, L2) 캐시에 있는 데이터를 **절대 포함하지 않습니다.** 데이터는 L1, L2, L3 중 오직 한 곳에만 존재합니다. (L3∩L2=∅)
    
- **장점:**
    
    - **캐시 용량 극대화:** 데이터 중복이 없으므로, CPU가 사용 가능한 총 캐시 용량은 L1 + L2 + L3가 됩니다.
        
- **단점:**
    
    - **복잡한 캐시 일관성 관리:** 특정 데이터를 찾으려면 L3뿐만 아니라 잠재적으로 모든 코어의 L1/L2 캐시까지 확인해야 하므로 복잡하고 지연이 발생할 수 있습니다.
        

---

## Intel과 AMD의 현재 방식

질문하신 것처럼 과거에는 두 회사의 전략이 명확히 갈렸습니다.

- **과거 Intel:** 네할렘(Nehalem), 샌디브릿지(Sandy Bridge) 시절까지 **포괄적(Inclusive)** L3 캐시를 고수했습니다.
    
- **과거 AMD:** K10, 불도저(Bulldozer) 아키텍처 등에서 **배타적(Exclusive)** L3 캐시를 사용했습니다.
    

하지만 현대 CPU는 코어 수가 많아지고 코어별 L2 캐시 용량 자체가 매우 커지면서, 두 가지 극단적인 방식 모두 비효율적이 되었습니다. (포괄적 방식은 L3의 낭비가 너무 심해지고, 배타적 방식은 코어가 많아질수록 일관성 관리가 복잡해짐)

### 현재의 표준: 비포괄적 (Non-Inclusive) 캐시

그래서 두 회사 모두 **비포괄적(Non-Inclusive)** 방식으로 옮겨왔습니다. 이는 "NINE (Non-Inclusive Non-Exclusive)"라고도 불리며, 두 정책의 장점을 절충한 방식입니다.

- **정의:** L3 캐시가 L1/L2의 데이터를 _반드시 포함할 필요는 없지만_, 포함할 수도 있는 유연한 방식입니다.
    
- **핵심 동작: '희생 캐시 (Victim Cache)'**
    
    - 현재 Intel(스카이레이크 이후)과 AMD(Zen 시리즈)의 L3 캐시는 주로 **'희생 캐시'**로 동작합니다.
        
    - 이는 코어의 L2 캐시가 꽉 차서 특정 데이터가 밀려날 때(evicted), 이 데이터를 (느린) 메인 메모리(RAM)로 바로 보내는 것이 아니라, 일단 L3 캐시로 보내 저장하는 방식입니다.
        
    - **이점:** 만약 다른 코어가 방금 L2에서 밀려난 그 데이터를 필요로 할 경우, RAM까지 갈 필요 없이 L3에서 훨씬 빠르게 가져올 수 있습니다.
        

### 요약

|구분|과거|현재|
|---|---|---|
|**Intel**|**포괄적 (Inclusive)** (예: 샌디브릿지)|**비포괄적 (Non-Inclusive)** / 희생 캐시 (예: 랩터레이크)|
|**AMD**|**배타적 (Exclusive)** (예: 불도저)|**비포괄적 (Non-Inclusive)** / 희생 캐시 (예: Zen 4)|


결론적으로, Intel과 AMD는 더 이상 L3 캐시 정책에서 근본적인 차이를 보이지 않으며, 멀티코어 환경에 최적화된 **'비포괄적(Non-Inclusive) 희생 캐시'**라는 동일한 방향으로 발전했습니다.

[캐시 정책: Inclusive, Exclusive, NINE](https://www.youtube.com/watch?v=zJzxHxThgPg) 이 영상은 포괄적(Inclusive), 배타적(Exclusive) 캐시의 개념과 함께 현재 CPU 아키텍처에서 중요하게 다루어지는 'NINE(비포괄적)' 캐시 정책에 대해 설명합니다.